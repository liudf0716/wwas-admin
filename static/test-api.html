<!DOCTYPE html>
<html>
<head>
    <title>APIé…ç½®æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>WWAS Admin APIé…ç½®æµ‹è¯•</h1>
    
    <div id="status"></div>
    
    <h2>æµ‹è¯•æ“ä½œ</h2>
    <button onclick="testApiConfig()">æµ‹è¯•APIé…ç½®</button>
    <button onclick="testSysInfo()">æµ‹è¯•ç³»ç»Ÿä¿¡æ¯API</button>
    <button onclick="testCorsRequest()">æµ‹è¯•CORSè¯·æ±‚</button>
    
    <h2>æµ‹è¯•ç»“æœ</h2>
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        function testApiConfig() {
            log('å¼€å§‹æµ‹è¯•APIé…ç½®...', 'info');
            
            // æ¨¡æ‹Ÿå¼€å‘ç¯å¢ƒ
            const isDev = location.hostname === 'localhost';
            log(`å½“å‰ç¯å¢ƒ: ${isDev ? 'å¼€å‘ç¯å¢ƒ (localhost)' : 'ç”Ÿäº§ç¯å¢ƒ (IPè®¿é—®)'}`, isDev ? 'success' : 'error');
            
            // æµ‹è¯•APIåŸºç¡€URL
            const expectedBaseUrl = isDev ? '/api' : 'http://192.168.67.109:8001';
            log(`æœŸæœ›çš„APIåŸºç¡€URL: ${expectedBaseUrl}`, 'info');
            
            if (isDev) {
                log('âœ… å¼€å‘ç¯å¢ƒé…ç½®æ­£ç¡®ï¼Œå°†ä½¿ç”¨webpackä»£ç†', 'success');
                log('è¯·æ±‚è·¯å¾„: /api/login â†’ ä»£ç†åˆ° â†’ http://192.168.67.109:8001/admin/login', 'info');
            } else {
                log('âš ï¸ å½“å‰é€šè¿‡IPè®¿é—®ï¼Œå¯èƒ½é‡åˆ°CORSé—®é¢˜', 'error');
                log('å»ºè®®æ”¹ç”¨: http://localhost:8080', 'error');
            }
        }

        function testSysInfo() {
            log('æµ‹è¯•ç³»ç»Ÿä¿¡æ¯API...', 'info');
            
            const apiUrl = '/api/sysinfo/detail';
            log(`å‘é€è¯·æ±‚åˆ°: ${apiUrl}`, 'info');
            
            fetch(apiUrl)
                .then(response => {
                    log(`å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    return response.json();
                })
                .then(data => {
                    log(`å“åº”æ•°æ®: <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                })
                .catch(error => {
                    log(`è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                    if (error.message.includes('CORS')) {
                        log('ğŸš¨ CORSé”™è¯¯ï¼è¯·ç¡®ä¿ä½¿ç”¨ http://localhost:8080 è®¿é—®', 'error');
                    }
                });
        }

        function testCorsRequest() {
            log('æµ‹è¯•CORSç­–ç•¥...', 'info');
            
            // æµ‹è¯•OPTIONSé¢„æ£€è¯·æ±‚
            fetch('/api/admin/login', {
                method: 'OPTIONS',
                headers: {
                    'Access-Control-Request-Method': 'POST',
                    'Access-Control-Request-Headers': 'Content-Type'
                }
            })
            .then(response => {
                log(`OPTIONSé¢„æ£€å“åº”: ${response.status}`, response.ok ? 'success' : 'error');
                
                const corsHeaders = {};
                response.headers.forEach((value, key) => {
                    if (key.toLowerCase().includes('access-control')) {
                        corsHeaders[key] = value;
                    }
                });
                
                log(`CORSå¤´éƒ¨: <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>`, 'info');
            })
            .catch(error => {
                log(`CORSæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...', 'info');
            testApiConfig();
        };
    </script>
</body>
</html>
